dist: xenial
sudo: required # Use the new travis docker based infrastructure
services:
  - docker
language: python
python:
  # We don't use the travis python, but we will use it for the build matrix
  - "3.6"
jobs:
  include:
    - stage: test
      script:
        - for a in $(ls assets/*.sh); do shellcheck $a;done
        - docker build -t opendatacube/datacube-index:latest .
    - stage: build
      if: (branch = master OR (tag = branch)) AND type = push
      script:
        - export TAG="0.1.$TRAVIS_BUILD_NUMBER"
        - docker build -t opendatacube/datacube-index:$TAG -t opendatacube/datacube-index:latest .
        - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
        - docker push opendatacube/datacube-index:$TAG
        - docker push opendatacube/datacube-index:latest
